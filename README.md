# 安装

> npm install debounce-save -S
> or
> yarn add debounce-save

# 触发自动保存的场景

- 数据改发生变时
- 用户关闭页面时
- 组件卸载时

# live demo

[demo](https://shuaiadong.github.io/debounce-save/index.html#/)

# 注意事项

> autosave 提供了`save` `debouncedSave` `cancel` ...`api`不要直接调用 ajax 请求 -> 破坏 autoSave 内部的生态系统

- 例如
  - 用户操作 修改了本次周报 切换 上周周报
  - state 的数据变成了上周
  - 因为 debounced 是延时执行，触发时 -> 获取数据是上周的数据

> 解决方案 - 用户切换时应该马上触发保存 `api` save

# 入参

```js
     // 默认参数
              wait: 2000,                   // default 防抖时间
              onSave: null,                 // 自动保存事件(ajax)
              onBeforeSave: null,           // 调用onSave 之前调用
              saveMessage: '确定要离开吗？',   // 提示语
              leading: false,               // 超时前调用
              maxWait: 1,                   // 延迟的最长时间
              trailing: true,               // 超时后调用
```

# API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

- [\_Utils\_](#_utils_)
  - [Parameters](#parameters)
- [\_Utils\_](#_utils_-1)
- [\_Utils\_](#_utils_-2)
- [options](#options)
  - [Parameters](#parameters-1)
- [saveHelp](#savehelp)
  - [Parameters](#parameters-2)
- [addBeforunload](#addbeforunload)
- [exit](#exit)

## \_Utils\_

autoSave

### Parameters

- `options`

Returns **[saveHelp](#savehelp)**

## \_Utils\_

1.  自动保存防抖
2.  离开浏览器 | 刷新浏览器 - 选择取消时保存
3.  组件卸载时保存

## \_Utils\_

1.  debouncedSave
    - debouncedSave | func
2.  直接保存
    - save | func
3.  取消 debounced
    - cancel | func
4.  清空
    - flush | func
5.  退出
    - exit | func

## options

Type: {}

### Parameters

- `wait` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 防抖时间 (optional, default `2000`)
- `onSave` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)?** 自动保存事件
- `onBeforeSave` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)?** 调用\_save 保存之前调用 return false 取消 保存
- `saveMessage` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** (optional, default `确定要离开吗？`)
- `leading` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** 超时前调用 (optional, default `false`)
- `maxWait` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 延迟的最长时间 (optional, default `0`)
- `trailing` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** 超时后调用 (optional, default `true`)

## saveHelp

Type: {}

### Parameters

- `debouncedSave` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)?** debounced save
- `save` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)?** 直接保存
- `cancel` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)?** 取消当前的 debouncedSave
- `flush` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)?** 清空
- `exit` **[function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function)?** 退出

##

true > 可以绑定定时间
|| 为了不重复绑定事件
|| 数据改变的识别

## addBeforunload

window.unload | exit
1\. Beforeunload 处理
2\. 组件销毁时：路由切换页面时

## exit

组件销毁 点击路由切换时调用
直接调用保存

# Usage

```js
import React, { Component } from 'react'
import autoSave from 'debounce-save'

export default class AutoSave extends Component {
  constructor(props) {
    super(props)
    this.autoSave = autoSave({
      onSave: () => {
        setTimeout(() => {
          this.setState({ log: `value = ${this.state.value},  success` })
        }, 0)
      }
    })
  }
  state = {
    value: '',
    log: 'log'
  }
  /**
   * autoSave({})
   * return ->
   *         debouncedSave
   *         save
   */

  render() {
    return (
      <div>
        <p>{this.state.log}</p>
        <input
          value={this.state.value}
          onChange={({ target: { value } }) => {
            this.setState({ value }, () => this.autoSave.debouncedSave())
          }}
        />
      </div>
    )
  }
}
```

# run demo

- cd \_demo
- npm i
- npm run server
